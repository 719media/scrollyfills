{"version":3,"file":"scrollyfills.module.js","sources":["../src/scrollend.js"],"sourcesContent":["const supported = \"onscrollend\" in window\n\nif (!supported) {\n  const scrollendEvent = new Event('scrollend');\n\n  // Map of scroll-observed elements.\n  let observed = new WeakMap();\n\n  // Forward and observe calls to a native method.\n  function observe(proto, method, handler) {\n    let native = proto[method];\n    proto[method] = function() {\n      let args = Array.prototype.slice.apply(arguments, [0]);\n      native.apply(this, args);\n      args.unshift(native);\n      handler.apply(this, args);\n    }\n  }\n  \n  function onAddListener(originalFn, type, handler, options) {\n    // Polyfill scrollend event on any element for which the developer listens\n    // to 'scrollend' explicitly or 'scroll' (so that adding a scrollend listener\n    // from within a scroll listener works).\n    if (type != 'scroll' && type != 'scrollend')\n      return;\n\n    let scrollport = this;\n    let data = observed.get(scrollport);\n    if (data === undefined) {\n      let timeout = 0;\n      data = {\n        scrollListener: (evt) => {\n          clearTimeout(timeout);\n          timeout = setTimeout(() => {\n            scrollport.dispatchEvent(scrollendEvent);\n            timeout = 0;\n          }, 100);\n        },\n        listeners: 0, // Count of number of listeners.\n      };\n      originalFn.apply(scrollport, ['scroll', data.scrollListener]);\n      observed.set(scrollport, data);\n    }\n    data.listeners++;\n  }\n\n  function onRemoveListener(originalFn, type, handler) {\n    if (type != 'scroll' && type != 'scrollend')\n      return;\n    let scrollport = this;\n    let data = observed.get(scrollport);\n\n    // Mismatched addEventListener / removeEventListener\n    // TODO: Should we explicitly track added listeners to prevent this?\n    if (data === undefined)\n      return;\n\n    data[type]--;\n    // If there are still listeners, nothing more to do.\n    if (--data.listeners > 0)\n      return;\n\n    // Otherwise, remove the added listeners.\n    originalFn.apply(scrollport, ['scroll', data.scrollListener]);\n    observed.delete(scrollport);\n  }\n\n  observe(Element.prototype, 'addEventListener', onAddListener);\n  observe(window, 'addEventListener', onAddListener);\n  observe(document, 'addEventListener', onAddListener);\n  observe(Element.prototype, 'removeEventListener', onRemoveListener);\n  observe(window, 'removeEventListener', onRemoveListener);\n  observe(document, 'removeEventListener', onRemoveListener);\n  // TODO: Polyfill onscroll, onscrollend as well?\n}\n"],"names":["proto","method","handler","native","Array","prototype","slice","apply","arguments","this","args","unshift","onAddListener","originalFn","type","options","scrollport","data","observed","get","undefined","scrollListener","evt","clearTimeout","timeout","setTimeout","dispatchEvent","scrollendEvent","listeners","set","onRemoveListener","Event","WeakMap","observe","Element","window","document"],"mappings":"AAEA,KAFkB,wBAEF,CAAA,MAOd,SAAiBA,EAAOC,EAAQC,GAC9B,IAAIC,EAASH,EAAMC,GACnBD,EAAMC,GAAU,WACd,MAAWG,MAAMC,UAAUC,MAAMC,MAAMC,UAAW,CAAC,IACnDL,EAAOI,MAAME,KAAMC,GACnBA,EAAKC,QAAQR,GACbD,EAAQK,MAAME,KAAMC,KAbVE,EAiBd,SAAuBC,EAAYC,EAAMZ,EAASa,GAIhD,GAAY,UAARD,GAA4B,aAARA,EAAxB,CAGA,IAAcE,EAAGP,KACTQ,EAAGC,EAASC,IAAIH,GACxB,QAAaI,IAATH,EAAoB,CACtB,MAAc,EACdA,EAAO,CACLI,eAAgB,SAACC,GACfC,aAAaC,GACbA,EAAUC,WAAW,WACnBT,EAAWU,cAAcC,GACzBH,EAAU,GACT,MAELI,UAAW,GAEbf,EAAWN,MAAMS,EAAY,CAAC,SAAUC,EAAKI,iBAC7CH,EAASW,IAAIb,EAAYC,GAE3BA,EAAKW,cAGEE,EAAT,SAA0BjB,EAAYC,EAAMZ,GAC1C,GAAY,UAARY,GAA4B,aAARA,EAAxB,CAEA,MAAiBL,KACbQ,EAAOC,EAASC,IAAIH,QAIXI,IAATH,IAGJA,EAAKH,OAECG,EAAKW,UAAY,IAIvBf,EAAWN,MAAMS,EAAY,CAAC,SAAUC,EAAKI,iBAC7CH,EAAQ,OAAQF,OA7DEW,EAAG,IAAAI,MAAU,aAG7Bb,EAAW,IAAIc,QA6DnBC,EAAQC,QAAQ7B,UAAW,mBAAoBO,GAC/CqB,EAAQE,OAAQ,mBAAoBvB,GACpCqB,EAAQG,SAAU,mBAAoBxB,GACtCqB,EAAQC,QAAQ7B,UAAW,sBAAuByB,GAClDG,EAAQE,OAAQ,sBAAuBL,GACvCG,EAAQG,SAAU,sBAAuBN"}